 name: Update Combined EPG

  on:
    schedule:
      - cron: '0 4 * * *'
    workflow_dispatch:

  jobs:
    update-epg:
      runs-on: ubuntu-latest
      permissions:
        contents: write
      steps:
        - uses: actions/checkout@v4
        - uses: actions/setup-python@v5
          with:
            python-version: '3.11'
        - run: pip install certifi
        - run: python combine_epg.py --output epg.xml
        - run: |
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git config user.name "github-actions[bot]"
            git add epg.xml
            git diff --staged --quiet || git commit -m "Update EPG - $(date -u '+%Y-%m-%d %H:%M UTC')"
            git push
